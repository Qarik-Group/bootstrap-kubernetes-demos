#!/bin/bash

set -eu

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

up() {
  echo "Install/upgrade Rancher via Helm"
  helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
  kubectl create namespace cattle-system || { echo '-> continuing...'; }
  helm upgrade --install rancher rancher-latest/rancher \
    --namespace cattle-system \
    --set ingress.tls.source=rancher \
    --set hostname=rancher.dev
  kubectl -n cattle-system rollout status deploy/rancher
}

case "${1:-usage}" in
  up)
    shift
    up
    ;;

  *)
    ;;
esac
